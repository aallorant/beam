---
title: "Collecting data to tell your own stories"
subtitle: "History and practice of surveys"
format: 
  revealjs:
    theme: sky
    slide-number: true
    transition: fade
    background-transition: slide
highlight-style: a11y
execute:
  code-link: true
  echo: true
editor_options: 
  chunk_output_type: console
css: styles.css
---


```{r}
#| echo: false
# Load packages
library(tidyverse)
library(readxl)
library(knitr)
library(ggthemes)

# Set theme for ggplot2
ggplot2::theme_set(ggplot2::theme_minimal(base_size = 14))

# Set width of code output
options(width = 65)

# Set figure parameters for knitr
knitr::opts_chunk$set(
  fig.width = 7, # 7" width
  fig.asp = 0.618, # the golden ratio
  fig.retina = 3, # dpi multiplier for displaying HTML output on retina
  fig.align = "center", # center align figures
  dpi = 300 # higher dpi, sharper image
)

```

# History of Data Collection in the US

## The US Census

```{r}
#| echo: false
# Load population data
pop_us <- read_csv("data/pop_us.csv")


# Create time-series plot
pop_plot <- ggplot(pop_us, aes(x = Year, y = Population)) +
  geom_line(color = "steelblue", size = 1) +
  geom_point(size = 2) +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Population of the United States (1790-2020)",
    subtitle = "Data from the Decennial Census",
    x = "Year",
    y = "Population",
    caption = "Source: US Census Bureau"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
    plot.subtitle = element_text(size = 14, hjust = 0.5),
    plot.caption = element_text(size = 12, hjust = 1),
    axis.title.x = element_text(face = "bold"),
    axis.title.y = element_text(face = "bold"),
    axis.text = element_text(size = 12)
  )

pop_plot

```

```{r}
#| echo: false
# Load population data
# Load necessary library
library(tidyverse)

# Create the data frame
race_ethnicity <- tibble::tribble(
  ~RaceEthnicity, ~Percentage,
  "White alone non-Hispanic", "57.8%",
  "Hispanic or Latino", "18.7%",
  "Black or African American alone", "12.1%",
  "Asian alone", "5.9%",
  "Two or more races", "2.7%",
  "American Indian and Alaska Native alone", "0.9%",
  "Native Hawaiian and Other Pacific Islander alone", "0.2%",
  "Other race alone", "1.3%"
)

# Convert percentage to numeric
race_ethnicity <- race_ethnicity %>%
  mutate(Percentage = as.numeric(str_replace(Percentage, "%", "")))

pie_chart <- ggplot(race_ethnicity, aes(x = "", y = Percentage, fill = RaceEthnicity)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y") +
  labs(
    title = "Race/Ethnicity Distribution in the US"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0.5, color = "#4682b4"),
    axis.title = element_blank(),
    axis.text = element_blank(),
    panel.grid = element_blank(),
    plot.background = element_blank(),
    legend.title = element_blank(),
    legend.text = element_text(size = 12, color = "#333333")
  ) +
  scale_fill_brewer(palette = "Set3") +
  geom_text(aes(label = paste0(Percentage, "%")), position = position_stack(vjust = 0.5), color = "black")

# Display pie chart
print(pie_chart)

```

## The US Census

::: incremental
- The US Census
  + A constitutional right
  + Assess every 10 years the equilibrium between each US State and their number of representatives at the Congress

<br>

- How?
  + Data sources: The **Decennial Census** and the **American Community Survey**
  + Unit of analysis: **Census Tracts** as the unit of analysis

<br>

- Which metrics?
  + **Median Household Income**
  + **Percentage of Black Residents**

- Why these metrics?
:::


## The Creation of the Census Bureau

- The Census Bureau was created in 1902
- Responsible for collecting data on the US population and economy
- Publishes various surveys and reports beyond the Decennial Census

# Principles for Survey and Data Collection

- Importance of sample design
- Question wording and order effects
- Data collection methods (e.g., face-to-face, telephone, online)
- Ethical considerations in data collection

# Critical Approaches to Quantification

## Quantitative Critical (QuantCrit) Research

### The Centrality of Oppression
- Structural racism and sexism plague systems
- Focus on identifying mechanisms and impacts of oppressive systems

### Data and Methods are Not Neutral
- Biases in data collection and analysis
- Use confidence intervals instead of p-values

### Data Cannot Speak for Itself
- Providing perspective to avoid dominant racist and sexist interpretations

### Groups are Neither Natural nor Inherent
- Identities are socially constructed and fluid
- Transparent data aggregation respecting identities

### Taking an Intersectional Perspective
- Identity is multifaceted
- Interaction terms for demographic variables in statistical models

### Valuing Narrative and Counter-Narrative
- Importance of lived experiences and counter-narratives
- Inclusion of diverse perspectives in research teams

# Survey data

## Happiness

```{r}
# Install and load necessary libraries


library(rvest)
library(tidyverse)

# URL of the webpage
url <- 'https://en.wikipedia.org/wiki/World_Happiness_Report'

# Read the HTML content from the webpage
webpage <- read_html(url)

# Extract all tables from the webpage
tables <- webpage %>%
  html_nodes("table")

# Initialize a list to store data frames
df_list <- list()

# Loop through each table, check if it contains "Country" or "Country or region", and store in the list
for (i in 1:length(tables)) {
  table <- tables[[i]] %>%
    html_table(fill = TRUE)
  # Check if the table has the relevant header
  if ("Country" %in% names(table) || "Country or region" %in% names(table)) {
    df_list[[length(df_list) + 1]] <- as.data.frame(table)
  }
}

# Combine all the data into one dataframe
happiness_data <- bind_rows(df_list, .id = "Year")

# Clean and rename columns
happiness_data <- happiness_data %>%
  rename_with(~ c("Rank", "Country", "Score", "GDP_per_capita", "Social_support", "Healthy_life_expectancy", "Freedom_to_make_life_choices", "Generosity", "Perceptions_of_corruption", "Dystopia_residual", "Year"), everything()) %>%
  select(Country, Score, Year) %>%
  filter(!is.na(Score)) %>%
  mutate(Score = as.numeric(Score),
         Year = as.numeric(Year))

# Select countries of interest
selected_countries <- c("United States", "Canada", "Mexico", "Finland", "Afghanistan")

# Filter the data for the selected countries
happiness_selected <- happiness_data %>%
  filter(Country %in% selected_countries) %>%
  select(Country, Score, Year)

# Create a time-series plot
happiness_time_series <- ggplot(happiness_selected, aes(x = Year, y = Score, color = Country, group = Country)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  labs(
    title = "Happiness Scores Over Time for Selected Countries",
    x = "Year",
    y = "Happiness Score",
    color = "Country"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0.5, color = "#4682b4"),
    axis.title.x = element_text(face = "bold", color = "#4682b4"),
    axis.title.y = element_text(face = "bold", color = "#4682b4"),
    axis.text = element_text(size = 12, color = "#333333"),
    legend.title = element_text(face = "bold", color = "#4682b4")
  )

# Display the plot
print(happiness_time_series)


```

## Principles of survey

1. Objective(s): **Why**
2. Target population: **Who**
3. Questions: **What**
4. Method of data collection: **How**

